{% extends "layout.html" %}

{#On charge une nouvelle navbar pour y ajouter les boutons d'interactions#}
{% block navbar %}
    <div class="navbar-fixed">
        <nav>
            <div class="nav-wrapper">
                <a href="{{ url_for('index') }}" class="brand-logo center"><img
                        src="{{ url_for('static', filename='img/logo.png') }}"></a>
                {% if 'email' in session %}
                    <ul id="nav-mobile" class="left hide-on-med-and-down">
                        {% if current_session.mode == "stream" %}
                            <li>
                                <button id="start-stream_button" action-target="{{ current_session._id }}"
                                        class="btn waves-effect waves-light green navbar_btn">Start
                                </button>
                            </li>
                            <li>
                                <button id="stop-stream_button" class="btn waves-effect waves-light red navbar_btn"
                                        disabled>Stop
                                </button>
                            </li>
                        {% else %}
                            <li>
                                <button data-batch="{{ current_session.tweets_batch }}" id="start-dated_tweets_button" action-target="{{ current_session._id }}"
                                        class="btn waves-effect waves-light green navbar_btn">
                                    Récupérer {{ current_session.tweets_batch }}
                                    tweets
                                </button>
                            </li>
                        {% endif %}
                        <li id="div_download_btn">
                            {% if number_of_tweets != 0 %}
                                <a class="waves-effect waves-light  grey darken-3 btn modal-trigger navbar_btn"
                                   id="download_btn"
                                   href="{{ url_for('download_file') }}"><i
                                        class="material-icons right">file_download</i>Exporter</a>
                            {% endif %}
                        </li>
                        <li>
                            <a class="btn waves-effect waves-light orange darken-2 navbar_btn"
                               href="{{ url_for('close_session') }}"><i
                                    class="material-icons right">close</i>Fermer</a>
                        </li>
                    </ul>
                    <ul id="nav-mobile" class="right hide-on-med-and-down">
                        <li><a href={{ url_for('logout') }}>Se
                            déconnecter</a></li>
                    </ul>
                {% endif %}
            </div>
        </nav>
    </div>
{% endblock %}

{% block body %}
    <div class="row">
        {#        Bandeau recap sur le côté #}
        <div class="querryRecap col m2 l2 s12 grey lighten-4 z-depth-3">
            <h4>{{ current_session.session_name }}</h4>
            <div class="divider"></div>
            <div class="section">
                <strong><i>Date de création</i></strong>
                <p>{{ current_session.start_date }}</p>
            </div>
            <div class="divider"></div>
            {% if current_session.exporter_user %}
                <div class="section">
                    <strong><i>Session exportée par</i></strong>
                    <p>{{ current_session.exporter_user }}</p>
                </div>
                <div class="divider"></div>
            {% endif %}
            <div class="section">
                <strong><i>Mode</i></strong>
                <p> {{ current_session.mode }}</p>
                <div class="divider"></div>
                {% for param in current_session.params %}
                    {% if current_session.params[param] and param!='geocode' %}
                        <div class="section">
                            <strong><i>{{ param }}</i></strong>
                            <p>{{ current_session.params[param] }}</p>
                        </div>
                        <div class="divider"></div>
                    {% endif %}
                {% endfor %}
            </div>
            {#        Fin du bandeau#}
        </div>
        {% if number_of_tweets == 0 %}
            <div id="no_tweet_div" class="col m6 l6 s6">
                <img src="{{ url_for('static', filename='img/arrow.png') }}">
                <blockquote style="margin: 20px 0;padding-left: 1.5rem;border-left: 5px solid #4CAF50;">
                    <h4>Vous n'avez toujours pas récupéré de tweets !</h4>
                    <blockquote style="margin: 20px 0;padding-left: 1.5rem;border-left: 5px solid #1976d2;">Commencez maintenant en appuyant sur "Récupérer" ou "Start" !</blockquote>
                </blockquote>
            </div>
        {% endif %}
        <div id="wordcloud_container" class="col m10 l10 s12 center" {% if number_of_tweets == 0 %} style="display: none" {% endif %}>
            <div {% if number_of_tweets == 0 or current_session.mode == "stream" %}
                style="display: none" {% endif %}
                class="preloader-wrapper big active"
                id="loading_circle">
                <div class="spinner-layer spinner-blue-only">
                    <div class="circle-clipper left">
                        <div class="circle"></div>
                    </div>
                    <div class="gap-patch">
                        <div class="circle"></div>
                    </div>
                    <div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                </div>
            </div>
            {#                Wordcloud général#}
            <div id="wordcloud"></div>
            <i {% if number_of_tweets == 0 %} style="display: none" {% endif %} class="flow-text">Nuage de mots général</i>
            {#                Fin Wordcloud général#}
        </div>
        <div class="querryRecap col m1 l1 s12 right grey lighten-4 z-depth-3">
            <h4 class="center" id="div_number_of_tweets"><strong>{{ number_of_tweets }}</strong></h4> tweets
            récupérés
        </div>
    </div>
    {% if current_session.mode == "dated_tweets" %}
        {% if number_of_tweets is number %}
            <div class="progress">
                {% set batch = current_session.tweets_batch | int %}
                <div class="determinate" id="barre_progression" style="width: {{ ((number_of_tweets % batch) / batch) * 100 }}%"></div>
            </div>
        {% endif %}
    {% endif %}

    <hr {% if number_of_tweets == 0 %} style="display: none" {% endif %} class="style-four">

    {#    Partie Interactive de l'interface#}
    <div id="interaction_container" class="container" {% if number_of_tweets == 0 %} style="display: none" {% endif %}>
        <div class="row">
            <div class="col m2 l2 s12">
                <strong><i>Intervalle de temps</i></strong>
                <form action="#">
                    <p>
                        <input value="172800" name="time_interval" type="radio" id="interval1"/>
                        <label for="interval1">2 jours</label>
                    </p>
                    <p>
                        <input value="86400" name="time_interval" type="radio" id="interval2"/>
                        <label for="interval2">1 jour</label>
                    </p>
                    <p>
                        <input value="43200" name="time_interval" type="radio" id="interval3"/>
                        <label for="interval3">12 heures</label>
                    </p>
                    <p>
                        <input value="3600" name="time_interval" type="radio" id="interval4"/>
                        <label for="interval4">1 heure</label>
                    </p>
                    <p>
                        <input value="600" name="time_interval" type="radio" id="interval5"/>
                        <label for="interval5">10 minutes</label>
                    </p>
                    <p>
                        <input value="60" name="time_interval" type="radio" id="interval6"/>
                        <label for="interval6">1 minute</label>
                    </p>
                    <p>
                        <input value="30" name="time_interval" type="radio" id="interval7"/>
                        <label for="interval7">30 secondes</label>
                    </p>
                </form>
            </div>
            <div class="col m6 l6 s12">
                {#                    Histogram#}
                <div class="duration" id="histogram">
                    <div id="tooltip" class="hidden">
                        <p id="user"></p>
                        <p id="content"></p>
                        <p id="nbrt"></p>
                    </div>
                </div>
                {#                    Fin Histogram#}
            </div>

        </div>
        <div class="row" style="display: none" id="lw_tw">
            <div class="col m6 l6 s6">
                <div id="little-wordcloud"></div>
            </div>
            <div class="col m6 l6 s6 graphs" id="twitterwidget"></div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript" src="{{ url_for('static', filename='js/script-session.js') }}"></script>
<script>
    var startdate ={% if startdate is defined %} {{ startdate | tojson }} {% else %}"";{% endif %}
    var stopdate ={% if stopdate is defined %} {{ stopdate | tojson }}{% else %}""; {% endif %}
</script>
{% endblock %}